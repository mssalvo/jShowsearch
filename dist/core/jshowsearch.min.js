/*!
 * jShowsearch v2.0.0 Â©
 * @author salvo mariniello - salvo.mariniello@gmail.com 
 * https://github.com/mssalvo/jShowsearch
 * MIT License
 * Copyright (c) 2020 Salvatore Mariniello
 * https://github.com/mssalvo/jShowsearch/blob/master/LICENSE
 * 
 * @see jShowsearch istance
 * @function jShowsearch.get('nameProcessUnique',{...})  
 * @example istance
 * 
 *           jShowsearch.get('myIstanceName', {
 *              form: '#myform', 
 *              btnSearch:'#btnAggiorna01',
 *              btnRemoveAll:'#btnRimuovi01',
 *              boxhome: '#home01',
 *              boxButton: '#button01',
 *              template: '#template01',
 *              templateButton:'<button {box} type="button" class="close" {click} aria-label="Close">Rimuovi Filtri <span aria-hidden="true">&times;</span></button>',
 *              esclude: ['id_element_1','id_element_2'],
 *              offEvent:false,
 *              offStorage:false,
 *              onInit: function (bol,list) {  alert("Init"+ bol)  },
 *              onRemove: function (id,obj,form) { alert("remove") },
 *              onRemoveAll: function (list,form) { alert("remove tutti") },
 *              onSearch: function (list,form) {alert("search") }
 *
 *          })
 *          
 *  @Object Control
 *  @Parameter
 *  {
 *     app:             |ID ELEMENTO | OBJECT HTML | OBBLIGATORIO | indicare l'elemento <form> o il <div> contenete gli elementi
 *     btnSearch:       |ID ELEMENTO | OBJECT HTML | FACOLTATIVO | indicare il button per aggiornare il contenuto visualizzato
 *     btnRemoveAll:       |ID ELEMENTO | OBJECT HTML | FACOLTATIVO | indicare il button per rimuovere i filtri nel contenuto visualizzato
 *     boxhome:         |ID ELEMENTO | OBJECT HTML | OBBLIGATORIO | indicare l'elemento html dove includere gli elementi creati
 *     boxButton:       |ID ELEMENTO | OBJECT HTML | FACOLTATIVO | indicare l'elemento html dove includere in pulsante rimuovi tutti filtri, 
 *                                                                 se non indicato ed e' presente un templateButton, questo verra' incluso come ultimo elemento nel boxhome.
 *     template:        |STRING HTML | ID ELEMENTO | OBJECT HTML | OBBLIGATORIO | indicare l'elemento html o la stringa che descrive la struttura html del template
 *     templateButton:  |STRING HTML | ID ELEMENTO | OBJECT HTML | FACOLTATIVO  | indicare l'elemento html o la stringa che descrive la struttura html del button rimuvi tutti
 *     esclude:         |STRING    | ARRAY  | FACOLTATIVO | esclude dalla lista degli elementi gli elementi indicati dall'id, 
 *                                                          gli elementi esclusi non verranno processati
 *     offEvent:        |BOOLEAN TRUE/FALSE | FACOLTATIVO | (false)abilita / (true)disabilita gli eventi sui campi del form       
 *     offStorage:      |BOOLEAN TRUE/FALSE | FACOLTATIVO | (false)abilita / (true)disabilita memorizzazione dei dati                                            
 *     onInit:		|FUNCTION | FACOLTATIVO | Esegue la funzione 1 sola volta alla fine della creazione
 *     onRemove:	|FUNCTION | FACOLTATIVO | Esegue la funzione su ogni elemento con marcatore {click} 
 *     onRemoveAll:	|FUNCTION | FACOLTATIVO | Esegue la funzione sul pulsante indicato < btnRemoveAll >
 *     onSearch:	|FUNCTION | FACOLTATIVO | Esegue la funzione sul pulsante indicato < btnSearch >
 *
 *  }
 *  
 *  
 *  @example Dichiarazione template
 *  @Importante il template indicato sia di tipo html o stringa deve contenere
 *              i seguenti marcatori {box} , {val} , {click}
 *     {box}   > va inserito sull'elemento principale della struttura html
 *     {val}   > va inserito dove deve comparire it testo descrittivo
 *     {click} > va inserito sull'elemento che deve eseguire l'azione
 *     
 *  	<template id="template01">
 *	<div {box} class="col alert alert-primary alert-dismissible fade show" role="alert">
 *		<strong> {val} </strong>
 *	<button type="button" class="close"  {click} aria-label="Close">
 *	  <span aria-hidden="true">&times;</span>
 *	</button>
 *	</div>   
 *	</template>
 *  
 *  
 *  @example Dichiarazione templateButton
 *  @Importante il templateButton indicato sia di tipo html o stringa deve contenere   
 *              i seguenti marcatori {box} , {val} , {click}
 *     {box}   > va inserito sull'elemento principale della struttura html
 *     {val}   > va inserito dove deve comparire it testo descrittivo
 *     {click} > va inserito sull'elemento che deve eseguire l'azione              
 *    <button {box} type="button" class="close" {click} aria-label="Close">Rimuovi Filtri <span aria-hidden="true">&times;</span></button>
 *    
 *  
 * */
(function(){if(typeof window.console==="undefined"||typeof window.console.warn==="undefined"||typeof window.console.error==="undefined"){window.console={log:function(){},warn:function(){},error:function(){}}}if(!("forEach" in Array.prototype)){Array.prototype.forEach=function(c,b){for(var a=0,d=this.length;a<d;a++){if(a in this){c.call(b,this[a],a,this)}}}}if(!("trim" in String.prototype)){String.prototype.trim=function(){var a=this;return a.replace(/^\s+|\s+$/gm,"")}}});function jShowsearch(b,a){this.inputs=[];this.name=b;this.boxApp=undefined;this.form=undefined;this.btnSearch=undefined;this.btnRemove=undefined;this.boxhome=undefined;this.boxButton=undefined;this.template=undefined;this.templateButton=undefined;this.after=function(){};this.onRemove=function(){};this.onRemoveAll=function(){};this.onSearch=function(){};this.onInit=function(){};this.esclude=undefined;this.isdelete=false;this.offStorage=false;this.offEvent=false;this.elements={};this.serialize={};this.init(a||{})}jShowsearch.istance={};jShowsearch.removeBox=function(a,b){jShowsearch.istance[a].removeBox(b).onRemove.apply(jShowsearch.istance[a],[b,jShowsearch.istance[a].elements[b].ob,jShowsearch.istance[a].form])};jShowsearch.removeAll=function(a){jShowsearch.istance[a].removeAll().onRemoveAll.apply(jShowsearch.istance[a],[jShowsearch.istance[a].elements,jShowsearch.istance[a].form])};jShowsearch.prototype.removeAll=function(){var a=this;for(var b in a.elements){var d=a.elements[b].ob;if(d&&d.type){var c=d.type.toUpperCase();switch(c){case"TEXT":case"TEXTAREA":case"PASSWORD":case"EMAIL":case"SEARCH":case"NUMBER":case"TIME":case"DATE":case"DATETIME":case"DATETIME-LOCAL":case"MONTH":case"URL":d.value="";break;case"CHECKBOX":case"RADIO":d.checked=false;break;case"SELECT":case"SELECT-ONE":d.value="";default:break}}}if(typeof(a.boxhome)!=="undefined"&&typeof a.boxhome.querySelectorAll==="function"){Array.prototype.forEach.call(a.boxhome.querySelectorAll("[showsearch]"),function(f,e){f.parentNode.removeChild(f)})}if(null!==a.boxButton&&typeof a.boxButton!=="undefined"){a.boxButton.innerHTML=""}a.search(false).setStorage();return a};jShowsearch.prototype.removeBox=function(e){var a=this;for(var b in a.elements){if(e===b){var d=a.elements[b].ob;if(d&&d.type){var c=d.type.toUpperCase();switch(c){case"TEXT":case"TEXTAREA":case"PASSWORD":case"EMAIL":case"SEARCH":case"NUMBER":case"TIME":case"DATE":case"DATETIME":case"DATETIME-LOCAL":case"MONTH":case"URL":d.value="";break;case"CHECKBOX":case"RADIO":d.checked=false;break;case"SELECT":case"SELECT-ONE":d.value="";default:break}}}}if(typeof(a.boxhome)!=="undefined"&&typeof a.boxhome.querySelectorAll==="function"){Array.prototype.forEach.call(a.boxhome.querySelectorAll("[showsearch]"),function(g,f){if(g.getAttribute("showsearch")===e){g.parentNode.removeChild(g)}})}a.search(false).setStorage();return a};jShowsearch.prototype.add=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"){a.inputs.push(document.getElementById(b)||document.querySelector(b))}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.inputs.push(b)}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.inputs.push(b.get(0))}else{window.console.warn("jShowsearch add:: impossible to add element[ "+b+" ]")}}}return a};jShowsearch.prototype.setTemplate=function(c){var b=this;var a=/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(c);if(typeof c==="string"&&a){b.template=c}else{if(typeof c==="string"&&c!=="undefined"&&!a){b.template=document.getElementById(c)?document.getElementById(c).innerHTML:document.querySelector(c)?document.querySelector(c).innerHTML:c}else{if(null!==c&&typeof c==="object"&&typeof c.jquery==="undefined"){b.template=c.innerHTML}else{if(null!==c&&typeof c==="object"&&typeof c.jquery==="string"){b.template=c.get(0).innerHTML}else{window.console.warn("jShowsearch setTemplate:: impossible to set the element template[ "+c+" ]")}}}}return b};jShowsearch.prototype.setTemplateButton=function(c){var b=this;var a=/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(c);if(typeof c==="string"&&a){b.templateButton=c}else{if(typeof c==="string"&&c!=="undefined"&&!a){b.templateButton=document.getElementById(c)?document.getElementById(c).innerHTML:document.querySelector(c)?document.querySelector(c).innerHTML:c}else{if(null!==c&&typeof c==="object"&&typeof c.jquery==="undefined"){b.templateButton=c.innerHTML}else{if(null!==c&&typeof c==="object"&&typeof c.jquery==="string"){b.templateButton=c.get(0).innerHTML}else{window.console.warn("jShowsearch setTemplateButton:: impossible to set the element templateButton[ "+c+" ]")}}}}return b};jShowsearch.prototype.setBoxHome=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"&&!/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(b)){a.boxhome=document.getElementById(b)||document.querySelector(b)}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.boxhome=b}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.boxhome=b.get(0)}else{window.console.warn("jShowsearch setBoxHome:: impossible to set the element boxhome[ "+b+" ]")}}}return a};jShowsearch.prototype.setBoxButton=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"&&!/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(b)){a.boxButton=document.getElementById(b)||document.querySelector(b)}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.boxButton=b}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.boxButton=b.get(0)}else{window.console.warn("jShowsearch setBoxButton:: impossible to set the element boxButton[ "+b+" ]")}}}return a};jShowsearch.prototype.setBtnSearch=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"&&!/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(b)){a.btnSearch=document.querySelectorAll(b).length?document.querySelectorAll(b):document.getElementById(b)?[document.getElementById(b)]:undefined}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.btnSearch=[b]}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.btnSearch=[b.get(0)]}else{window.console.warn("jShowsearch setBtnSearch:: impossible to set the element btnSearch[ "+b+" ]")}}}return a};jShowsearch.prototype.setBtnRemove=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"&&!/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(b)){a.btnRemove=document.querySelectorAll(b).length?document.querySelectorAll(b):document.getElementById(b)?[document.getElementById(b)]:undefined}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.btnRemove=[b]}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.btnRemove=[b.get(0)]}else{window.console.warn("jShowsearch setBtnRemove:: impossible to set the element btnRemove[ "+b+" ]")}}}return a};jShowsearch.prototype.setForm=function(b){var a=this;if(typeof b==="string"&&b!=="undefined"&&!/^<(\w*)\s*\/?(?:.* <\/\1>|)/.test(b)){a.boxApp=document.getElementById(b)||document.querySelector(b)}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="undefined"){a.boxApp=b}else{if(null!==b&&typeof b==="object"&&typeof b.jquery==="string"){a.boxApp=b.get(0)}else{window.console.warn("jShowsearch form:: impossible to set the element boxApp[ "+b+" ]")}}}return a};jShowsearch.prototype.init=function(b){var a=this;if(b&&b.app){a.setForm(b.app)}if(b&&b.boxhome){a.setBoxHome(b.boxhome)}if(b&&b.boxButton){a.setBoxButton(b.boxButton)}if(b&&b.btnSearch){a.setBtnSearch(b.btnSearch)}if(b&&b.btnRemoveAll){a.setBtnRemove(b.btnRemoveAll)}if(b&&b.template){a.setTemplate(b.template)}if(b&&b.templateButton){a.setTemplateButton(b.templateButton)}if(b&&typeof b.esclude==="string"){a.esclude=(b.esclude).split(",")}if(b&&typeof b.esclude==="object"){a.esclude=b.esclude}if(b&&typeof b.action==="function"){a.after=b.action}if(b&&typeof b.onInit==="function"){a.onInit=b.onInit}if(b&&typeof b.onRemoveAll==="function"){a.onRemoveAll=b.onRemoveAll}if(b&&typeof b.onRemove==="function"){a.onRemove=b.onRemove}if(b&&typeof b.onSearch==="function"){a.onSearch=b.onSearch}if(b&&typeof(b.offEvent)==="boolean"){a.offEvent=b.offEvent}if(b&&typeof(b.offStorage)==="boolean"){a.offStorage=b.offStorage}a.storage().getStorage();return a.searchForm().search(true).includeEvent()};jShowsearch.prototype.searchForm=function(){var c=this;if(null!==c.boxApp&&typeof c.boxApp!=="undefined"&&c.boxApp.tagName==="FORM"){c.form=c.boxApp}else{if(null!==c.boxApp&&typeof c.boxApp!=="undefined"&&c.boxApp.tagName!=="FORM"){var a=c.boxApp.querySelectorAll("*")||c.boxApp.getElementsByTagName("*");for(var b in a){switch(a[b].tagName){case"FORM":c.form=a[b];break}}}else{throw Error("jShowsearch searchForm:: the boxapp and form element is [ undefined ]")}}return c};jShowsearch.prototype.setValue=function(b){if(b&&b.type){var a=b.type.toUpperCase();switch(a){case"TEXT":case"TEXTAREA":case"PASSWORD":case"EMAIL":case"SEARCH":case"NUMBER":case"TIME":case"DATE":case"DATETIME":case"DATETIME-LOCAL":case"MONTH":case"URL":return b.value||"";case"CHECKBOX":case"RADIO":if(b.parentElement.htmlFor&&b.parentElement.htmlFor===b.id||b.parentElement.htmlFor===b.name){return b.checked?b.parentElement.innerText:""}else{return b.checked?b.value:""}case"SELECT":case"SELECT-ONE":return b.options[b.selectedIndex].value?b.options[b.selectedIndex].text:"";default:return""}}return"undefined"};jShowsearch.prototype.search=function(c){var e=this;e.serialize={};if(null!==e.boxApp&&typeof e.boxApp!=="undefined"){var a=e.boxApp.elements||e.boxApp.querySelectorAll("*")||e.boxApp.getElementsByTagName("*");for(var d in a){switch(a[d].tagName){case"INPUT":case"TEXTAREA":case"SELECT":if(a[d].id&&a[d].type.toUpperCase()!=="HIDDEN"){e.elements[a[d].id]={val:e.setValue(a[d]),ob:a[d]};e.serialize[a[d].id]=e.setObject(a[d]);if(c){e.add(a[d])}}break;case"DIV":case"SPAN":case"P":case"PRE":case"CITE":case"CODE":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TD":if(a[d].contentEditable&&a[d].isContentEditable){e.elements[a[d].id]={val:a[d].innerHTML,ob:a[d]};e.serialize[a[d].id]=a[d].innerHTML;if(c){e.add(a[d])}}break}}return e.write()}else{throw Error("jShowsearch search:: the boxapp element is [ undefined ]")}return e};jShowsearch.prototype.includeEvent=function(){var b=this;if(null!==b.btnSearch&&typeof b.btnSearch!=="undefined"){Array.prototype.forEach.call(b.btnSearch,function(d,c){d.addEventListener("click",function(){b.search(0).setUniqueSubmit("1").setStorage().onSearch.apply(b,[b.elements,b.form])},false)})}if(null!==b.btnRemove&&typeof b.btnRemove!=="undefined"){Array.prototype.forEach.call(b.btnRemove,function(d,c){d.addEventListener("click",function(){b.removeAll().getStorage().onRemoveAll.apply(b,[b.elements,b.form])},false)})}if(!this.offEvent&&b.inputs.length){for(var a in b.inputs){b.inputs[a].addEventListener("change",function(){b.search(0).setStorage()},false)}}if(b.boxhome&&b.boxhome.querySelectorAll){b.onInit.apply(b,[b.boxhome.querySelectorAll("[showsearch]").length,b])}return b};jShowsearch.prototype.submit=function(){var a=this;if(a.getUniqueSubmit()==="0"){a.setUniqueSubmit("1");a.form.submit()}else{a.setUniqueSubmit("0")}return a};jShowsearch.prototype.clear=function(){var b=this;if(typeof b.esclude!=="undefined"){for(var c in b.elements){for(var a in b.esclude){if(b.esclude[a]===c){delete b.elements[c]}}}}};jShowsearch.prototype.isVisible=function(a){return !!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)};jShowsearch.prototype.isElementVisible=function(b){if(!(b instanceof Element)){throw Error("jShowsearch:isElementVisible:: elem is not an element.")}var a=getComputedStyle(b);if(a.display==="none"){return false}if(a.visibility!=="visible"){return false}if(a.opacity<0.1){return false}return true};jShowsearch.prototype.write=function(){var b=this;if(null!==b.template&&typeof b.template!=="undefined"){b.clear();var d=b.template;var a=[];for(var c in b.elements){if(b.elements[c].val.trim()!==""){a.push(String(d).replace(/\=""/g,"").replace(/\{box}/g,'showsearch="'+c+'"').replace(/\{val}/g,b.elements[c].val).replace(/\{click}/g,"onclick=\"jShowsearch.removeBox('"+b.name+"','"+c+"')\""))}}if(a.length&&null!==b.templateButton&&typeof b.templateButton!=="undefined"){var e=String(b.templateButton).replace(/\=""/g,"").replace(/\{box}/g,'showsearch="removeAll"').replace(/\{val}/g,"Rimuovi Filtri").replace(/\{click}/g,"onclick=\"jShowsearch.removeAll('"+b.name+"')\"");if(null!==b.boxButton&&typeof b.boxButton!=="undefined"){b.boxButton.innerHTML=e}else{if(a.length>1){a.push(e)}}}b.boxhome.innerHTML=a.join("")}else{window.console.error("jShowsearch write:: the template element is [ undefined ]")}return b};jShowsearch.prototype.storage=function(){this._wd=window;this.baseHistory={};this.setProperty=function(o,v){if(o&&o.tagName){switch(o.tagName){case"INPUT":var elemType=o.type.toUpperCase();switch(elemType){case"TEXT":case"PASSWORD":case"FILE":o.value=v;break;case"CHECKBOX":case"RADIO":o.checked=v;break}break;case"TEXTAREA":o.value=v;break;case"SELECT":for(var i=0;i<o.options.length;i++){if(o.options[i].text==v){o.selectedIndex=i;break}}break;case"HTML":case"BODY":case"DIV":case"SPAN":case"P":case"PRE":case"BLOCKQUOTE":case"CODE":case"CITE":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TD":if(o.innerHTML){o.innerHTML=v}break}}};this.setObject=function(o){if(o&&o.type){var elemType=o.type.toUpperCase();switch(elemType){case"TEXT":case"TEXTAREA":case"PASSWORD":case"EMAIL":case"SEARCH":case"NUMBER":case"TIME":case"DATE":case"DATETIME":case"DATETIME-LOCAL":case"MONTH":case"URL":return o.value||"";case"CHECKBOX":case"RADIO":return o.checked;case"SELECT":case"SELECT-ONE":return o.options[o.selectedIndex].text;default:return""}return"undefined"}};this.setUniqueSubmit=function(a){if("localStorage" in window&&window.localStorage){localStorage.setItem("isform_",typeof a!=="undefined"?a:"1")}else{var obj=this.baseHistory.isform=a;this._wd.name=JSON.stringify(obj,"")||""}return this};this.getUniqueSubmit=function(){if("localStorage" in window&&window.localStorage){return localStorage.getItem("isform_")}else{var obj=this._wd.eval("("+this._wd.name+")");return obj&&typeof obj.isform_!=="undefined"?obj.isform_:"1"}};this.setHistory=function(){var a_=JSON.stringify(this.baseHistory,"");if("localStorage" in window&&window.localStorage){localStorage.setItem("history_",a_||"")}else{this._wd.name=a_||""}};this.getHistory=function(){if("localStorage" in window&&window.localStorage){return String(localStorage.getItem("history_")).length>5?this._wd.eval("("+localStorage.getItem("history_")+")"):{}}else{return String(this._wd.name).length>5?this._wd.eval("("+this._wd.name+")"):{}}};this.getStorage=function(){if(!this.offStorage){this.baseHistory=this.getHistory();if(this.baseHistory[this.name]!=null&&this.baseHistory[this.name]!=undefined){var obj_=this.baseHistory[this.name];for(var i in obj_){(function(x,o,f){f(document.getElementById(x),o[x])})(i,obj_,this.setProperty)}}}return this};this.setStorage=function(){if(!this.offStorage){this.baseHistory=this.getHistory();this.baseHistory[this.name]=this.serialize;this.setHistory()}return this};return this};jShowsearch.get=function(b,a){var d,c;if(typeof(arguments[0])==="object"){c=arguments[0]}else{if(typeof(arguments[0])==="string"){d=arguments[0]}}if(typeof(arguments[1])==="object"){c=arguments[1]}else{if(typeof(arguments[1])==="string"){d=arguments[1]}}if(typeof(d)==="undefined"){d=new Date().getTime()}if(typeof(jShowsearch.istance[d])==="undefined"){jShowsearch.istance[d]=new jShowsearch(d,c)}return jShowsearch.istance[d]};